var __reflect=this&&this.__reflect||function(b,e,k){b.__class__=e;k?k.push(e):k=[e];b.__types__=b.__types__?k.concat(b.__types__):k},__extends=this&&this.__extends||function(b,e){function k(){this.constructor=b}for(var a in e)e.hasOwnProperty(a)&&(b[a]=e[a]);k.prototype=e.prototype;b.prototype=new k},__decorate=this&&this.__decorate||function(b,e,k,a){var c=arguments.length,g=3>c?e:null===a?a=Object.getOwnPropertyDescriptor(e,k):a,d;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=
Reflect.decorate(b,e,k,a);else for(var f=b.length-1;0<=f;f--)if(d=b[f])g=(3>c?d(g):3<c?d(e,k,g):d(e,k))||g;return 3<c&&g&&Object.defineProperty(e,k,g),g},RES;(function(b){})(RES||(RES={}));
(function(b){function e(c){var a=b.config.config.fileSystem.getFile(c);a||(c=b.resourceNameSelector(c),a=b.config.config.fileSystem.getFile(c));return a}b.resourceNameSelector=function(c){return c};b.getResourceInfo=e;var k;b.setConfigURL=function(c,a){k={type:0<=c.indexOf(".json")?"legacyResourceConfig":"resourceConfig",root:a,url:c,name:c}};var a=function(){function a(){}a.prototype.init=function(){this.config||(this.config={alias:{},groups:{},resourceRoot:k.root,mergeSelector:null,fileSystem:null,
loadGroup:[]});return b.queue.pushResItem(k).catch(function(a){b.isCompatible||a.__resource_manager_error__||(a.error?console.error(a.error.stack):console.error(a.stack),a=new b.ResourceManagerError(1002));b.host.remove(k);return Promise.reject(a)})};a.prototype.getGroupByName=function(a){a=this.config.groups[a];var d=[];if(!a)return d;for(var c=0;c<a.length;c++){var g=b.config.getResourceWithSubkey(a[c]);if(null!=g){var m=g.r;g=g.key;if(null==m)throw new b.ResourceManagerError(2005,g);-1==d.indexOf(m)&&
d.push(m)}}return d};a.prototype.__temp__get__type__via__url=function(a){var d=this.config.alias[a];d||(d=a);if(b.typeSelector){a=b.typeSelector(d);if(!a)throw new b.ResourceManagerError(2004,d);return a}console.warn("RES.mapConfig \u5e76\u672a\u8bbe\u7f6e typeSelector");return"unknown"};a.prototype.getResourceWithSubkey=function(a){a=this.getKeyByAlias(a);var d=a.indexOf("#"),c="";0<=d&&(c=a.substr(d+1),a=a.substr(0,d));return(d=this.getResource(a))?{r:d,key:a,subkey:c}:null};a.prototype.getKeyByAlias=
function(a){return this.config.alias[a]?this.config.alias[a]:a};a.prototype.getResource=function(a){var d=this.config.alias[a];d||(d=a);return(a=e(d))?a:null};a.prototype.createGroup=function(a,d,c){void 0===c&&(c=!1);if(!c&&this.config.groups[a]||!d||0==d.length)return!1;c=[];for(var b=0;b<d.length;b++){var f=d[b];this.config.groups[f]?c=c.concat(this.config.groups[f]):c.push(f)}this.config.groups[a]=c;return!0};a.prototype.addSubkey=function(a,d){this.addAlias(a,d+"#"+a)};a.prototype.addAlias=function(a,
d){this.config.alias[d]&&(d=this.config.alias[d]);this.config.alias[a]=d};a.prototype.addResourceData=function(a){b.hasRes(a.name)||(a.type||(a.type=this.__temp__get__type__via__url(a.url)),b.config.config.fileSystem.addFile(a))};a.prototype.removeResourceData=function(a){b.hasRes(a.name)&&(b.config.config.fileSystem.removeFile(a.url),this.config.alias[a.name]&&delete this.config.alias[a.name])};return a}();b.ResourceConfig=a;__reflect(a.prototype,"RES.ResourceConfig")})(RES||(RES={}));
(function(b){var e=function(){function e(){this.groupTotalDic={};this.numLoadedDic={};this.groupErrorDic={};this.retryTimesDic={};this.maxRetryTimes=3;this.reporterDic={};this.dispatcherDic={};this.failedList=[];this.loadItemErrorDic={};this.errorDic={};this.itemListPriorityDic={};this.itemLoadDic={};this.promiseHash={};this.lazyLoadList=[];this.loadingCount=0;this.thread=4}e.prototype.pushResItem=function(a){if(this.promiseHash[a.root+a.name])return this.promiseHash[a.root+a.name];this.lazyLoadList.push(a);
this.itemListPriorityDic[Number.NEGATIVE_INFINITY]=this.lazyLoadList;this.updatelistPriority(this.lazyLoadList,Number.NEGATIVE_INFINITY);var c=new egret.EventDispatcher;this.dispatcherDic[a.root+a.name]=c;var b=new Promise(function(d,a){c.addEventListener("complete",function(a){d(a.data)},null);c.addEventListener("error",function(d){a(d.data)},null)});this.promiseHash[a.root+a.name]=b;this.loadNextResource();return b};e.prototype.pushResGroup=function(a,c,b,d){if(this.promiseHash[c])return this.promiseHash[c];
for(var f=a.length,h=0;h<f;h++){var g=a[h];g.groupNames||(g.groupNames=[]);g.groupNames.push(c)}this.groupTotalDic[c]=a.length;this.numLoadedDic[c]=0;this.updatelistPriority(a,b);this.reporterDic[c]=d;var e=new egret.EventDispatcher;this.dispatcherDic[c]=e;a=new Promise(function(d,a){e.addEventListener("complete",d,null);e.addEventListener("error",function(d){a(d.data)},null)});this.promiseHash[c]=a;this.loadNextResource();return a};e.prototype.updatelistPriority=function(a,c){void 0==this.itemListPriorityDic[c]&&
(this.itemListPriorityDic[c]=[]);for(var b=0;b<a.length;b++){var d=a[b];if(1!=this.itemLoadDic[d.root+d.name]){var f=this.findPriorityInDic(d);void 0==f?this.itemListPriorityDic[c].push(d):f<c&&(this.itemListPriorityDic[c].push(d),d=this.itemListPriorityDic[f].indexOf(d),this.itemListPriorityDic[f].splice(d,1))}}};e.prototype.findPriorityInDic=function(a){for(var c in this.itemListPriorityDic)if(-1<this.itemListPriorityDic[c].indexOf(a))return parseInt(c)};e.prototype.loadNextResource=function(){for(;this.loadingCount<
this.thread&&this.loadSingleResource(););};e.prototype.loadSingleResource=function(){var a=this,c=this.getOneResourceInfoInGroup();if(!c)return!1;this.itemLoadDic[c.root+c.name]=1;this.loadingCount++;this.loadResource(c).then(function(g){a.loadingCount--;delete a.itemLoadDic[c.root+c.name];b.host.save(c,g);a.promiseHash[c.root+c.name]&&a.deleteDispatcher(c.root+c.name).dispatchEventWith("complete",!1,g);if(g=c.groupNames){delete c.groupNames;for(var d=0;d<g.length;d++){var f=g[d];a.setGroupProgress(f,
c)&&a.loadGroupEnd(f)}}a.loadNextResource()}).catch(function(g){if(!g)throw c.name+" load fail";if(!g.__resource_manager_error__)throw g;delete a.itemLoadDic[c.root+c.name];a.loadingCount--;delete b.host.state[c.root+c.name];var d=a.retryTimesDic[c.name]||1;if(d>a.maxRetryTimes){if(delete a.retryTimesDic[c.name],a.promiseHash[c.root+c.name]&&a.deleteDispatcher(c.root+c.name).dispatchEventWith("error",!1,{r:c,error:g}),d=c.groupNames){delete c.groupNames;for(var f=0;f<d.length;f++){var h=d[f];a.loadItemErrorDic[h]||
(a.loadItemErrorDic[h]=[]);-1==a.loadItemErrorDic[h].indexOf(c)&&a.loadItemErrorDic[h].push(c);a.groupErrorDic[h]=!0;a.setGroupProgress(h,c)?a.loadGroupEnd(h,g):a.errorDic[h]=g}}}else a.retryTimesDic[c.name]=d+1,a.failedList.push(c);a.loadNextResource()});return!0};e.prototype.getOneResourceInfoInGroup=function(){if(0<this.failedList.length)return this.failedList.shift();var a=Number.NEGATIVE_INFINITY,c;for(c in this.itemListPriorityDic)a=Math.max(a,c);if(c=this.itemListPriorityDic[a])return 0==c.length?
(delete this.itemListPriorityDic[a],this.getOneResourceInfoInGroup()):c.shift()};e.prototype.setGroupProgress=function(a,c){var b=this.reporterDic[a];this.numLoadedDic[a]++;var d=this.numLoadedDic[a];a=this.groupTotalDic[a];if(b&&b.onProgress)b.onProgress(d,a,c);return d==a};e.prototype.loadGroupEnd=function(a,c){delete this.groupTotalDic[a];delete this.numLoadedDic[a];delete this.reporterDic[a];var b=this.deleteDispatcher(a);if(c)delete this.groupErrorDic[a],d=this.loadItemErrorDic[a],delete this.loadItemErrorDic[a],
b.dispatchEventWith("error",!1,{itemList:d,lastError:c});else if(d=this.groupErrorDic[a],delete this.groupErrorDic[a],d){var d=this.loadItemErrorDic[a];delete this.loadItemErrorDic[a];c=this.errorDic[a];delete this.errorDic[a];b.dispatchEventWith("error",!1,{itemList:d,error:c})}else b.dispatchEventWith("complete")};e.prototype.deleteDispatcher=function(a){delete this.promiseHash[a];var c=this.dispatcherDic[a];delete this.dispatcherDic[a];return c};e.prototype.loadResource=function(a,c){if(!c){if(1==
b.FEATURE_FLAG.FIX_DUPLICATE_LOAD){c=b.host.state[a.root+a.name];if(2==c)return Promise.resolve(b.host.get(a));if(1==c)return a.promise}c=b.processor.isSupport(a)}if(!c)throw new b.ResourceManagerError(2001,a.name,a.type);b.host.state[a.root+a.name]=1;c=c.onLoadStart(b.host,a);return a.promise=c};e.prototype.unloadResource=function(a){if(!b.host.get(a))return console.warn("\u5c1d\u8bd5\u91ca\u653e\u4e0d\u5b58\u5728\u7684\u8d44\u6e90:",a.name),!1;var c=b.processor.isSupport(a);c&&(c.onRemoveStart(b.host,
a),b.host.remove(a),1==a.extra&&b.config.removeResourceData(a));return!0};return e}();b.ResourceLoader=e;__reflect(e.prototype,"RES.ResourceLoader")})(RES||(RES={}));
(function(b){b.checkNull=function(b,k,a){var c=a.value;a.value=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];if(a[0])return c.apply(this,a);console.warn("\u65b9\u6cd5"+k+"\u7684\u53c2\u6570\u4e0d\u80fd\u4e3anull");return null}};b.FEATURE_FLAG={FIX_DUPLICATE_LOAD:1};(function(b){b.setUpgradeGuideLevel=function(b){}})(b.upgrade||(b.upgrade={}))})(RES||(RES={}));
(function(b){function e(a){if(b.isCompatible)a.catch(function(a){}).then();else return a}b.nameSelector=function(a){return b.path.basename(a).split(".").join("_")};b.typeSelector=function(a){a=a.substr(a.lastIndexOf(".")+1);switch(a){case b.ResourceItem.TYPE_XML:case b.ResourceItem.TYPE_JSON:case b.ResourceItem.TYPE_SHEET:break;case "png":case "jpg":case "gif":case "jpeg":case "bmp":a=b.ResourceItem.TYPE_IMAGE;break;case "fnt":a=b.ResourceItem.TYPE_FONT;break;case "txt":a=b.ResourceItem.TYPE_TEXT;
break;case "mp3":case "ogg":case "mpeg":case "wav":case "m4a":case "mp4":case "aiff":case "wma":case "mid":a=b.ResourceItem.TYPE_SOUND;break;case "mergeJson":case "zip":case "pvr":break;default:a=b.ResourceItem.TYPE_BIN}return a};b.registerAnalyzer=function(a,g){throw new b.ResourceManagerError(2002);};b.setIsCompatible=function(a){b.isCompatible=a};b.isCompatible=!1;b.loadConfig=function(c,g){0<=g.indexOf("://")?(g=g.split("://"),g=g[0]+"://"+b.path.normalize(g[1]+"/")):g=b.path.normalize(g+"/");
c=c.replace(g,"");b.setConfigURL(c,g);a||(a=new k);return e(a.loadConfig())};b.loadGroup=function(b,g,d){void 0===g&&(g=0);return e(a.loadGroup(b,g,d))};b.isGroupLoaded=function(b){return a.isGroupLoaded(b)};b.getGroupByName=function(c){return a.getGroupByName(c).map(function(a){return b.ResourceItem.convertToResItem(a)})};b.createGroup=function(b,g,d){void 0===d&&(d=!1);return a.createGroup(b,g,d)};b.hasRes=function(b){return a.hasRes(b)};b.getRes=function(b){return a.getRes(b)};b.getResAsync=function(b,
g,d){return e(a.getResAsync.apply(a,arguments))};b.getResByUrl=function(b,g,d,f,h){void 0===f&&(f="");return a?e(a.getResByUrl(b,g,d,f,h)):(b=egret.sys.tr(3200),egret.warn(b),Promise.reject(b))};b.destroyRes=function(b,g){return a.destroyRes(b,g)};b.setMaxLoadingThread=function(b){a||(a=new k);a.setMaxLoadingThread(b)};b.setMaxRetryTimes=function(b){a.setMaxRetryTimes(b)};b.addEventListener=function(b,g,d,f,h){void 0===f&&(f=!1);void 0===h&&(h=0);a||(a=new k);a.addEventListener(b,g,d,f,h)};b.removeEventListener=
function(b,g,d,f){void 0===f&&(f=!1);a.removeEventListener(b,g,d,f)};b.$addResourceData=function(b){a.addResourceData(b)};b.getVersionController=function(){a||(a=new k);return a.vcs};b.registerVersionController=function(b){a||(a=new k);a.registerVersionController(b)};b.getVirtualUrl=function(b){return a.vcs?a.vcs.getVirtualUrl(b):b};var k=function(a){function c(){var d=a.call(this)||this;d.isVcsInit=!1;d.normalLoadConfig=function(){return b.config.init().then(function(a){b.ResourceEvent.dispatchResourceEvent(d,
b.ResourceEvent.CONFIG_COMPLETE)},function(a){b.ResourceEvent.dispatchResourceEvent(d,b.ResourceEvent.CONFIG_LOAD_ERROR);return Promise.reject(a)})};b.VersionController&&(d.vcs=new b.VersionController);return d}__extends(c,a);c.prototype.registerVersionController=function(a){this.vcs=a;this.isVcsInit=!1};c.prototype.loadConfig=function(){var a=this;return!this.isVcsInit&&this.vcs?(this.isVcsInit=!0,this.vcs.init().then(function(){return a.normalLoadConfig()})):this.normalLoadConfig()};c.prototype.isGroupLoaded=
function(a){return b.config.getGroupByName(a).every(function(a){return null!=b.host.get(a)})};c.prototype.getGroupByName=function(a){return b.config.getGroupByName(a)};c.prototype.loadGroup=function(a,c,h){var d=this;void 0===c&&(c=0);return this._loadGroup(a,c,{onProgress:function(c,f,e){if(h&&h.onProgress)h.onProgress(c,f,e);b.ResourceEvent.dispatchResourceEvent(d,b.ResourceEvent.GROUP_PROGRESS,a,e,c,f)}}).then(function(c){-1==b.config.config.loadGroup.indexOf(a)&&b.config.config.loadGroup.push(a);
b.ResourceEvent.dispatchResourceEvent(d,b.ResourceEvent.GROUP_COMPLETE,a)},function(c){-1==b.config.config.loadGroup.indexOf(a)&&b.config.config.loadGroup.push(a);if(c.itemList)for(var f=c.itemList,h=f.length,e=0;e<h;e++){var g=f[e];delete g.promise;b.ResourceEvent.dispatchResourceEvent(d,b.ResourceEvent.ITEM_LOAD_ERROR,a,g)}b.isCompatible&&console.warn(c.error.message);b.ResourceEvent.dispatchResourceEvent(d,b.ResourceEvent.GROUP_LOAD_ERROR,a);return Promise.reject(c.error)})};c.prototype._loadGroup=
function(a,c,h){void 0===c&&(c=0);var d=b.config.getGroupByName(a);return 0==d.length?new Promise(function(d,c){c({error:new b.ResourceManagerError(2005,a)})}):b.queue.pushResGroup(d,a,c,h)};c.prototype.createGroup=function(a,c,h){void 0===h&&(h=!1);return b.config.createGroup(a,c,h)};c.prototype.hasRes=function(a){return null!=b.config.getResourceWithSubkey(a)};c.prototype.getRes=function(a){var d=b.config.getResourceWithSubkey(a);if(d){a=d.r;var c=d.key;d=d.subkey;var e=b.processor.isSupport(a);
return e&&e.getData&&d?e.getData(b.host,a,c,d):b.host.get(a)}return null};c.prototype.getResAsync=function(a,c,h){var d=this,f=b.config.getResourceWithSubkey(a);if(null==f)return c&&c.call(h,null,a),Promise.reject(new b.ResourceManagerError(2006,a));var e=this.getRes(a);if(e)return c&&egret.callLater(function(){c.call(h,e,a)},this),Promise.resolve(e);var g=f.r,k=f.subkey;return b.queue.pushResItem(g).then(function(d){b.host.save(g,d);var f=b.processor.isSupport(g);f&&f.getData&&k&&(d=f.getData(b.host,
g,a,k));c&&c.call(h,d,a);return d},function(f){b.host.remove(g);b.ResourceEvent.dispatchResourceEvent(d,b.ResourceEvent.ITEM_LOAD_ERROR,"",g);return c?(c.call(h,null,a),Promise.reject(null)):Promise.reject(f)})};c.prototype.getResByUrl=function(a,c,h,e,g){var d=this;void 0===e&&(e="");var f=b.config.getResource(a);if(!f){e||(e=b.config.__temp__get__type__via__url(a));g||(g=a);f={name:g,url:a,type:e,root:"",extra:1};b.config.addResourceData(f);f=b.config.getResource(g);if(!f)throw"never";f.root="";
f.url=a}return b.queue.pushResItem(f).then(function(a){b.host.save(f,a);c&&f&&c.call(h,a,f.url);return a},function(e){b.host.remove(f);b.ResourceEvent.dispatchResourceEvent(d,b.ResourceEvent.ITEM_LOAD_ERROR,"",f);return c?(c.call(h,null,a),Promise.reject(null)):Promise.reject(e)})};c.prototype.destroyRes=function(a,c){void 0===c&&(c=!0);var d=b.config.getGroupByName(a);if(d&&0<d.length){var f=b.config.config.loadGroup.indexOf(a);if(-1==f)return!1;if(c||1==b.config.config.loadGroup.length&&b.config.config.loadGroup[0]==
a)for(a=0;a<d.length;a++){var e=d[a];b.queue.unloadResource(e)}else{a={};c=0;for(var g=b.config.config.loadGroup;c<g.length;c++){var k=g[c];for(e in b.config.config.groups[k]){var n=b.config.config.groups[k][e];a[n]?a[n]++:a[n]=1}}for(c=0;c<d.length;c++)e=d[c],a[e.name]&&1==a[e.name]&&b.queue.unloadResource(e)}b.config.config.loadGroup.splice(f,1);return!0}if(e=b.config.getResource(a))return b.queue.unloadResource(e);console.warn("\u5728\u5185\u5b58"+a+"\u8d44\u6e90\u4e0d\u5b58\u5728");return!1};
c.prototype.setMaxLoadingThread=function(a){1>a&&(a=1);b.queue.thread=a};c.prototype.setMaxRetryTimes=function(a){a=Math.max(a,0);b.queue.maxRetryTimes=a};c.prototype.addResourceData=function(a){a.root="";b.config.addResourceData(a)};__decorate([b.checkNull],c.prototype,"hasRes",null);__decorate([b.checkNull],c.prototype,"getRes",null);__decorate([b.checkNull],c.prototype,"getResAsync",null);__decorate([b.checkNull],c.prototype,"getResByUrl",null);return c}(egret.EventDispatcher);b.Resource=k;__reflect(k.prototype,
"RES.Resource");var a})(RES||(RES={}));(function(b){(function(b){b.normalize=function(b){var a=b.split("/");return a.filter(function(b,e){return!!b||e==a.length-1}).join("/")};b.basename=function(b){return b.substr(b.lastIndexOf("/")+1)};b.dirname=function(b){return b.substr(0,b.lastIndexOf("/"))}})(b.path||(b.path={}))})(RES||(RES={}));
(function(b){var e=function(){function b(){}b.prototype.init=function(){this.versionInfo=this.getLocalData("all.manifest");return Promise.resolve()};b.prototype.getVirtualUrl=function(a){return a};b.prototype.getLocalData=function(a){if(egret_native.readUpdateFileSync&&egret_native.readResourceFileSync){var b=egret_native.readUpdateFileSync(a);if(null!=b)return JSON.parse(b);b=egret_native.readResourceFileSync(a);if(null!=b)return JSON.parse(b)}return null};return b}();b.NativeVersionController=e;
__reflect(e.prototype,"RES.NativeVersionController",["RES.IVersionController"]);egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(b.VersionController=e)})(RES||(RES={}));
(function(b){(function(e){function k(a,c){var d=this;return new Promise(function(f,e){a.addEventListener(egret.Event.COMPLETE,function(){f(a.data?a.data:a.response)},d);a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(){var a=new b.ResourceManagerError(1001,c.url);e(a)},d)})}function a(a,b){if(-1!=b.indexOf("://"))return b;a=a.split("\\").join("/");var d=a.match(/#.*|\?.*/),c="";d&&(c=d[0]);d=a.lastIndexOf("/");a=-1!=d?a.substring(0,d+1)+b:b;return a+c}function c(a){return{name:a.name+"_alpha",
url:a.etc1_alpha_url,type:"ktx",root:a.root}}e.isSupport=function(a){return e._map[a.type]};e.map=function(a,b){e._map[a]=b};e.getRelativePath=a;e.ImageProcessor={onLoadStart:function(a,c){var d=new egret.ImageLoader;d.load(b.getVirtualUrl(c.root+c.url));return k(d,c).then(function(b){var d=new egret.Texture;d._setBitmapData(b);(b=a.resourceConfig.getResource(c.name))&&b.scale9grid&&(b=b.scale9grid.split(","),d.scale9Grid=new egret.Rectangle(parseInt(b[0]),parseInt(b[1]),parseInt(b[2]),parseInt(b[3])));
return d})},onRemoveStart:function(a,b){a.get(b).dispose()}};e.KTXTextureProcessor={onLoadStart:function(a,b){return a.load(b,"bin").then(function(d){if(!d)return console.error("ktx:"+b.root+b.url+" is null"),null;var c=new egret.KTXContainer(d,1);if(c.isInvalid)return console.error("ktx:"+b.root+b.url+" is invalid"),null;d=new egret.BitmapData(d);d.debugCompressedTextureURL=b.root+b.url;d.format="ktx";c.uploadLevels(d,!1);c=new egret.Texture;c._setBitmapData(d);(d=a.resourceConfig.getResource(b.name))&&
d.scale9grid&&(d=d.scale9grid.split(","),c.scale9Grid=new egret.Rectangle(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]),parseInt(d[3])));a.save(b,c);return c},function(d){a.remove(b);throw d;})},onRemoveStart:function(a,b){(a=a.get(b))&&a.dispose()}};e.makeEtc1SeperatedAlphaResourceInfo=c;e.ETC1KTXProcessor={onLoadStart:function(a,b){return a.load(b,"ktx").then(function(d){if(!d)return null;if(b.etc1_alpha_url){var f=c(b);return a.load(f,"ktx").then(function(b){d&&d.$bitmapData&&b.$bitmapData?(d.$bitmapData.etcAlphaMask=
b.$bitmapData,a.save(f,b)):a.remove(f);return d},function(b){a.remove(f);throw b;})}return d},function(d){a.remove(b);throw d;})},onRemoveStart:function(a,b){var d=a.get(b);d&&d.dispose();b.etc1_alpha_url&&(b=c(b),(d=a.get(b))&&d.dispose(),a.unload(b))}};e.BinaryProcessor={onLoadStart:function(a,c){a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.ARRAY_BUFFER;a.open(b.getVirtualUrl(c.root+c.url),"get");a.send();return k(a,c)},onRemoveStart:function(a,b){}};e.TextProcessor={onLoadStart:function(a,
c){a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT;a.open(b.getVirtualUrl(c.root+c.url),"get");a.send();return k(a,c)},onRemoveStart:function(a,b){return!0}};e.JsonProcessor={onLoadStart:function(a,b){return a.load(b,"text").then(function(a){return JSON.parse(a)})},onRemoveStart:function(a,b){}};e.XMLProcessor={onLoadStart:function(a,b){return a.load(b,"text").then(function(a){return egret.XML.parse(a)})},onRemoveStart:function(a,b){return!0}};e.CommonJSProcessor={onLoadStart:function(a,
c){return a.load(c,"text").then(function(a){a=new Function("require","exports",a);var d={};try{a(function(){},d)}catch(t){throw new b.ResourceManagerError(2003,c.name,t.message);}return d})},onRemoveStart:function(a,b){}};e.SheetProcessor={onLoadStart:function(c,e){return c.load(e,"json").then(function(d){var f=c.resourceConfig.getResource(b.nameSelector(d.file));if(!f){var g=a(e.url,d.file);f={name:g,url:g,type:"image",root:e.root}}return c.load(f).then(function(a){if(!a)return null;var b=d.frames,
e=new egret.SpriteSheet(a);e.$resourceInfo=f;for(var g in b){var h=b[g],k=e.createTexture(g,h.x,h.y,h.w,h.h,h.offX,h.offY,h.sourceW,h.sourceH);h.scale9grid&&(h=h.scale9grid.split(","),k.scale9Grid=new egret.Rectangle(parseInt(h[0]),parseInt(h[1]),parseInt(h[2]),parseInt(h[3])))}c.save(f,a);return e},function(a){c.remove(f);throw a;})})},getData:function(a,b,c,e){return(a=a.get(b))?a.getTexture(e):null},onRemoveStart:function(a,b){b=a.get(b);var c=b.$resourceInfo;b.dispose();a.unload(c)}};var g=function(a,
b){var c="";b=b.split("\n")[2];var d=b.indexOf('file="');-1!=d&&(b=b.substring(d+6),d=b.indexOf('"'),c=b.substring(0,d));a=a.split("\\").join("/");d=a.lastIndexOf("/");return a=-1!=d?a.substring(0,d+1)+c:c};e.FontProcessor={onLoadStart:function(c,e){return c.load(e,"text").then(function(d){try{var f=JSON.parse(d)}catch(u){f=d}d="string"===typeof f?g(e.url,f):a(e.url,f.file);var h=c.resourceConfig.getResource(b.nameSelector(d));h||(h={name:d,url:d,type:"image",root:e.root});return c.load(h).then(function(a){var b=
new egret.BitmapFont(a,f);b.$resourceInfo=h;c.save(h,a);return b},function(a){c.remove(h);throw a;})})},onRemoveStart:function(a,b){b=a.get(b).$resourceInfo;a.unload(b)}};e.SoundProcessor={onLoadStart:function(a,c){var d=new egret.Sound;d.load(b.getVirtualUrl(c.root+c.url));return k(d,c).then(function(){return d})},onRemoveStart:function(a,b){a.get(b).close()}};e.MovieClipProcessor={onLoadStart:function(a,c){var d,e;return a.load(c,"json").then(function(g){d=g;g=c.name;g=g.substring(0,g.lastIndexOf("."))+
".png";e=a.resourceConfig.getResource(g);if(!e)throw new b.ResourceManagerError(1001,g);return a.load(e)}).then(function(b){a.save(e,b);return new egret.MovieClipDataFactory(d,b)})},onRemoveStart:function(a,b){var c=a.get(b);c.clearCache();c.$spriteSheet.dispose();b=b.name;b=b.substring(0,b.lastIndexOf("."))+".png";(b=a.resourceConfig.getResource(b))&&a.unload(b)}};e.MergeJSONProcessor={onLoadStart:function(a,c){return a.load(c,"json").then(function(a){for(var d in a)b.config.addSubkey(d,c.name);
return a})},getData:function(a,b,c,e){if(a=a.get(b))return a[e];console.error("missing resource :"+b.name);return null},onRemoveStart:function(a,b){}};e.LegacyResourceConfigProcessor={onLoadStart:function(a,c){return a.load(c,"json").then(function(d){var e=b.config.config,g=c.root,f=e.fileSystem;f||(f={fsData:{},getFile:function(a){return l[a]},addFile:function(a){a.type||(a.type="");void 0==g&&(a.root="");l[a.name]=a},profile:function(){console.log(l)},removeFile:function(a){delete l[a]}},e.fileSystem=
f);for(var h=e.groups,k=0,q=d.groups;k<q.length;k++){var p=q[k];h[p.name]=""==p.keys?[]:p.keys.split(",")}var r=e.alias,l=f.fsData;e=function(a){l[a.name]=a;l[a.name].root=g;a.subkeys&&a.subkeys.split(",").forEach(function(b){r[b]=a.name+"#"+b;r[a.name+"."+b]=a.name+"#"+b})};f=0;for(h=d.resources;f<h.length;f++)e(h[f]);a.save(c,d);return d})},onRemoveStart:function(){}};e._map={image:e.ImageProcessor,json:e.JsonProcessor,text:e.TextProcessor,xml:e.XMLProcessor,sheet:e.SheetProcessor,font:e.FontProcessor,
bin:e.BinaryProcessor,commonjs:e.CommonJSProcessor,sound:e.SoundProcessor,movieclip:e.MovieClipProcessor,mergeJson:e.MergeJSONProcessor,legacyResourceConfig:e.LegacyResourceConfigProcessor,ktx:e.KTXTextureProcessor,"etc1.ktx":e.ETC1KTXProcessor,"pvrtc.ktx":e.KTXTextureProcessor}})(b.processor||(b.processor={}))})(RES||(RES={}));
(function(b){var e=function(e){function a(a,b,d){void 0===b&&(b=!1);void 0===d&&(d=!1);a=e.call(this,a,b,d)||this;a.itemsLoaded=0;a.itemsTotal=0;a.groupName="";return a}__extends(a,e);a.dispatchResourceEvent=function(c,e,d,f,h,k){void 0===d&&(d="");void 0===f&&(f=void 0);void 0===h&&(h=0);void 0===k&&(k=0);e=egret.Event.create(a,e);e.groupName=d;f&&(e.resItem=b.ResourceItem.convertToResItem(f));e.itemsLoaded=h;e.itemsTotal=k;c=c.dispatchEvent(e);egret.Event.release(e);return c};a.ITEM_LOAD_ERROR=
"itemLoadError";a.CONFIG_COMPLETE="configComplete";a.CONFIG_LOAD_ERROR="configLoadError";a.GROUP_PROGRESS="groupProgress";a.GROUP_COMPLETE="groupComplete";a.GROUP_LOAD_ERROR="groupLoadError";return a}(egret.Event);b.ResourceEvent=e;__reflect(e.prototype,"RES.ResourceEvent")})(RES||(RES={}));
(function(b){(function(e){e.TYPE_XML="xml";e.TYPE_IMAGE="image";e.TYPE_BIN="bin";e.TYPE_TEXT="text";e.TYPE_JSON="json";e.TYPE_SHEET="sheet";e.TYPE_FONT="font";e.TYPE_SOUND="sound";e.convertToResItem=function(e){var a=e.name;if(b.config.config)for(var c in b.config.config.alias)b.config.config.alias[c]==e.url&&(a=c);else a=e.url;return{name:a,url:e.url,type:e.type,data:e,root:e.root}}})(b.ResourceItem||(b.ResourceItem={}))})(RES||(RES={}));
(function(b){var e=function(){function e(a){this.data=a}e.prototype.profile=function(){console.log(this.data)};e.prototype.addFile=function(a,c){c||(c="");a=b.path.normalize(a);var e=b.path.basename(a),d=b.path.dirname(a);this.exists(d)||this.mkdir(d);this.resolve(d)[e]={url:a,type:c}};e.prototype.getFile=function(a){var b=this.resolve(a);b&&(b.name=a);return b};e.prototype.resolve=function(a){if(""==a)return this.data;a=b.path.normalize(a);a=a.split("/");for(var c=this.data,e=0;e<a.length;e++){var d=
a[e];if(c)c=c[d];else break}return c};e.prototype.mkdir=function(a){a=b.path.normalize(a);a=a.split("/");for(var c=this.data,e=0;e<a.length;e++){var d=a[e];c[d]||(c[d]={});c=c[d]}};e.prototype.exists=function(a){if(""==a)return!0;a=b.path.normalize(a);a=a.split("/");for(var c=this.data,e=0;e<a.length;e++){var d=a[e];if(!c[d])return!1;c=c[d]}return!0};return e}();b.NewFileSystem=e;__reflect(e.prototype,"RES.NewFileSystem")})(RES||(RES={}));
(function(b){var e={};b.profile=function(){b.config.config.fileSystem.profile();console.log(e);var a=0,c;for(c in e){var g=e[c];g instanceof egret.Texture&&(a+=g.$bitmapWidth*g.$bitmapHeight*4)}console.log("gpu size : "+(a/1024).toFixed(3)+"kb")};b.host={state:{},get resourceConfig(){return b.config},load:function(a,c){return b.queue.loadResource(a,"string"==typeof c?b.processor._map[c]:c)},unload:function(a){return b.queue.unloadResource(a)},save:function(a,c){b.host.state[a.root+a.name]=2;delete a.promise;
e[a.root+a.name]=c},get:function(a){return e[a.root+a.name]},remove:function(a){delete b.host.state[a.root+a.name];delete e[a.root+a.name]}};b.config=new b.ResourceConfig;b.queue=new b.ResourceLoader;var k=function(a){function b(c,d,e){var f=a.call(this)||this;f.__resource_manager_error__=!0;f.name=c.toString();f.message=b.errorMessage[c].replace("{0}",d).replace("{1}",e);return f}__extends(b,a);b.errorMessage={1001:"\u6587\u4ef6\u52a0\u8f7d\u5931\u8d25:{0}",1002:"ResourceManager \u521d\u59cb\u5316\u5931\u8d25\uff1a\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5931\u8d25",
2001:"{0}\u89e3\u6790\u5931\u8d25,\u4e0d\u652f\u6301\u6307\u5b9a\u89e3\u6790\u7c7b\u578b:'{1}'\uff0c\u8bf7\u7f16\u5199\u81ea\u5b9a\u4e49 Processor \uff0c\u66f4\u591a\u5185\u5bb9\u8bf7\u53c2\u89c1 https://github.com/egret-labs/resourcemanager/blob/master/docs/README.md#processor",2002:"Analyzer \u76f8\u5173API \u5728 ResourceManager \u4e2d\u4e0d\u518d\u652f\u6301\uff0c\u8bf7\u7f16\u5199\u81ea\u5b9a\u4e49 Processor \uff0c\u66f4\u591a\u5185\u5bb9\u8bf7\u53c2\u89c1 https://github.com/egret-labs/resourcemanager/blob/master/docs/README.md#processor",
2003:"{0}\u89e3\u6790\u5931\u8d25,\u9519\u8bef\u539f\u56e0:{1}",2004:"\u65e0\u6cd5\u627e\u5230\u6587\u4ef6\u7c7b\u578b:{0}",2005:'RES\u52a0\u8f7d\u4e86\u4e0d\u5b58\u5728\u6216\u7a7a\u7684\u8d44\u6e90\u7ec4:"{0}"',2006:"\u8d44\u6e90\u914d\u7f6e\u6587\u4ef6\u4e2d\u65e0\u6cd5\u627e\u5230\u7279\u5b9a\u7684\u8d44\u6e90:{0}"};return b}(Error);b.ResourceManagerError=k;__reflect(k.prototype,"RES.ResourceManagerError")})(RES||(RES={}));